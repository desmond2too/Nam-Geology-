<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nam Geology App</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css">
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/styles.css"> 
    <link rel="shortcut icon" type="image/png" href="Images/gsnlogo.png">


    <!-- PWA Meta Tags -->
<meta name="theme-color" content="#3a7ca5">
<link rel="manifest" href="/manifest.json">

<!-- iOS Safari PWA Support -->
 <!-- ... other meta tags ... -->
  <meta name="mobile-web-app-capable" content="yes">
  <!-- Optional: Keep the deprecated tag for older iOS compatibility -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <!-- ... other head elements ... -->
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="mobile-icons/gsnlogo-192x192.png">

<!-- Windows PWA Support -->
<meta name="msapplication-TileImage" content="mobile-icons/icon-144x144.png">
<meta name="msapplication-TileColor" content="#3a7ca5">
</head>

<div id="logo-container" class="leaflet-control">
    <img src="Images/mimelogo1.png" alt="MME Logo" id="mimelogo" class="map-logo">
    <img src="Images/gsnlogo.png" alt="GSN Logo" id="gsnlogo" class="map-logo">
</div>

<body> 
    <!-- Main application container -->
    <div id="app-container">
        <!-- Left sidebar for controls and legend -->
        <div id="sidebar">
            <!-- Panel content area -->
            <div id="panel-content">
                <!-- Legend Panel (default visible) -->
                <div class="panel-view" id="legend-panel">
                    <!-- Search functionality for locations within Namibia -->
                    <div class="sidebar-section">
                        <div class="search-container" style="margin-top: 10px;">
                            <div class="search-input-container">
                                <input type="text" id="search-input" placeholder="Search places in Namibia..." class="search-input">
                                <i class="fas fa-search search-icon"></i>
                            </div>
                            <div id="search-results" class="search-results"></div>
                        </div>
                    </div>
                    
                    <!-- Map layers section -->
                    <div class="sidebar-section">
                        <div class="sidebar-header" id="layers-header">
                            MAP LAYERS
                            <div class="toggle-button">></div>
                        </div>
                        <div class="sidebar-content" id="layers-content">
                            <!-- Geological data layers -->
                            <div class="layer-group">
                                <div class="layer-group-title"> 1:1mil Geological Layers</div>
                                <div class="layer-item">
                                    <input type="radio" name="geology" id="major-geological-units">
                                    <label for="major-geological-units">Major Geological Units</label>
                                </div>
                                <div class="layer-item">
                                    <input type="radio" name="geology" id="geology-age">
                                    <label for="geology-age">Geology: Age</label>
                                </div>
                                <div class="layer-item">
                                    <input type="radio" name="geology" id="dominant-rock-types">
                                    <label for="dominant-rock-types">Dominant Rock Types</label>
                                </div>
                                <div class="layer-item">
                                    <input type="radio" name="geology" id="minerals">
                                    <label for="minerals">Minerals</label>
                                </div>
                            </div>
                            
                            <!-- Reference/orientation layers -->
                            <div class="layer-group">
                                <div class="layer-group-title">Orientation Datasets</div>
                                <div class="layer-item">
                                    <input type="checkbox" id="towns-villages">
                                    <label for="towns-villages">Towns and Villages</label>
                                </div>
                                <div class="layer-item">
                                    <input type="checkbox" id="national-monuments">
                                    <label for="national-monuments">National Monuments Sites</label>
                                </div>
                                <div class="layer-item">
                                    <input type="checkbox" id="geotourism-sites">
                                    <label for="geotourism-sites">Geotourism Sites</label>
                                </div>
                                <div class="layer-item">
                                    <input type="checkbox" id="national-roads">
                                    <label for="national-roads">National Roads</label>
                                </div>
                                <div class="layer-item">
                                    <input type="checkbox" id="protected-areas">
                                    <label for="protected-areas">Protected Areas/Parks</label>
                                </div>
                                <div class="layer-item">
                                    <input type="checkbox" id="regional-boundaries">
                                    <label for="regional-boundaries">Regional Boundaries</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="sidebar-overlay" id="sidebar-overlay"></div>
                    
                    <!-- Map legend section -->
                    <div class="sidebar-section">
                        <div class="sidebar-header" id="legend-header">
                            MAP LEGEND
                            <div class="toggle-button">></div>
                        </div>
                        <div class="sidebar-content" id="legend-content">
                            <div class="map-legend">
                                <!-- Legend content populated dynamically -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Attribute Table Panel (hidden by default) -->
   <div class="panel-view" id="attribute-table-panel" style="display: none;">
    <div class="panel-header">Attribute Table Panel</div>
    <div class="panel-body">
        <div class="search-container">
            <div class="search-input-container">
                <input type="text" id="attribute-search-input" placeholder="Search datasets..." class="search-input">
                <i class="fas fa-search search-icon" id="attribute-search-icon"></i>
            </div>
            <div id="attribute-search-results" class="search-results"></div>
        </div>
        
        <div class="attribute-table-container">
            <div class="results-header">
                <h4>Attribute Data</h4>
                <div class="results-count">0 records found</div>
            </div>
            <div class="results-table-container">
                <table class="results-table" id="attribute-data-table">
                    <thead>
                        <tr>
                            <th>Layer</th>
                            <th>Feature</th>
                            <th>Type</th>
                            <th>Location</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Results will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
                
                <!-- Select Panel (hidden by default) -->
                <div class="panel-view" id="select-panel" style="display: none;">
                    <div class="panel-header">Select Panel</div>
                    <div class="panel-body">
                        <div class="select-controls">
                            <button id="select-polygon" class="select-btn" title="Select by Polygon">
                                <div class="btn-icon">
                                    <img src="Icons/Selection.png" alt="Polygon" class="select-icon">
                                </div>
                                <span class="btn-text">Polygon</span>
                                <div class="active-indicator"></div>
                            </button>
                            
                            <button id="select-point" class="select-btn" title="Select by Point">
                                <div class="btn-icon">
                                    <img src="Icons/select_point2.PNG" alt="Point" class="select-icon">
                                </div>
                                <span class="btn-text">Point</span>
                                <div class="active-indicator"></div>
                            </button>
                            
                            <button id="clear-selection" class="select-btn clear-btn" title="Clear Selection">
                                <div class="btn-icon">
                                    <i class="fas fa-trash-alt"></i>
                                </div>
                                <span class="btn-text">Clear</span>
                            </button>
                        </div>
                        
                        <div id="select-results">
                            <div class="results-header">
                                <h4>Selected Features</h4>
                                <div class="results-count">0 features found</div>
                            </div>
                            <div class="results-table-container">
                                <table class="results-table">
                                    <thead>
                                        <tr>
                                            <th>Layer</th>
                                            <th>Feature</th>
                                            <th>Details</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Results will be populated here -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <div class="sidebar-section" style="margin-bottom: 15px;">
                            <div class="sidebar-content" style="font-size: 15px; color: #ccc;">
                                <p><strong>Selection By Polygon:</strong></p>
                                <p>Click the Polygon button, then the map to draw, add points, and double-click to finish</p>
                                
                                <p><strong>Selection By Point:</strong></p>
                                <p>Click Point button, then click on the map to select features</p>
                                
                                <p style="margin-top: 10px;"><i><strong>Note:</strong> Click "Clear" to remove all selections</i></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Measure Panel (hidden by default) -->
                <div class="panel-view" id="measure-panel" style="display: none;">
                    <div class="panel-header">Measure Panel</div>
                    <div class="panel-body">
                        <div class="measure-controls">
                            <button id="measure-distance" class="measure-btn" title="Measure Distance">
                                <div class="btn-icon">
                                    <img src="Icons/icon_dist2.png" alt="Distance" class="measure-icon">
                                </div>
                                <span class="btn-text">Distance</span>
                                <div class="active-indicator"></div>
                            </button>
                            
                            <button id="measure-area" class="measure-btn" title="Measure Area">
                                <div class="btn-icon">
                                    <img src="Icons/Measure_Area.png" alt="Area" class="measure-icon">
                                </div>
                                <span class="btn-text">Area</span>
                                <div class="active-indicator"></div>
                            </button>
                            
                            <button id="clear-measure" class="measure-btn clear-btn" title="Clear Measurements">
                                <div class="btn-icon">
                                    <i class="fas fa-trash-alt"></i>
                                </div>
                                <span class="btn-text">Clear</span>
                            </button>
                        </div>
                        <div id="measure-results">
                            <div id="distance-result">
                                <h4>Distance Measurement</h4>
                                <p>Total: <span id="distance-total">0 km</span></p>
                                <p>Segment: <span id="distance-segment">0 km</span></p>
                            </div>
                            <div id="area-result">
                                <h4>Area Measurement</h4>
                                <p>Area: <span id="area-total">0 ha</span></p>
                                <p>Perimeter: <span id="perimeter-total">0 km</span></p>
                            </div>
                        </div>
                        <div class="sidebar-section" style="margin-bottom: 15px;">
                            <div class="sidebar-content" style="font-size: 15px; color: #ccc;">
                                <p><strong>Distance Measurement:</strong></p>
                                <p>Click the Area button, then the map to measure, add points, and double-click to finish</p>
                                
                                <p><strong>Area Measurement:</strong></p>
                                <p>Click Area button, draw polygon then double-click to finish</p>
                                
                                <p style="margin-top: 10px;"><i><strong>Note:</strong> Click "Clear" to remove all measurements</i></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Vertical panel controls (right side) -->
            <div id="panel-controls">
                <div class="panel-btn active" data-panel="legend">
                    <span>Legend</span>
                </div>
                
                <div class="panel-btn" data-panel="attribute-table">
                    <span>Att.Table</span>
                </div>
                <div class="panel-btn" data-panel="select">
                    <span>Select</span>
                </div>
                <div class="panel-btn" data-panel="measure">
                    <span>Measure</span>
                </div>
                <div class="panel-btn" id="rock-identifier-button" onclick="window.open('rock-identifier.html', '_blank')">
                <span>ROCK ID</span>
                </div>
                <div class="panel-btn" id="ai-button" style="margin-top: auto;">
                    <span>ASK AI</span>
                    <img src="Icons/ai-logo1.png" alt="AI Logo" class="ai-logo">
                </div>
                
            </div>
        </div>
        
        <!-- Main map container -->
        <div id="map-container">
            <!-- App Title -->
            <div id="app-title">Nam Geology App</div>
            
         <!-- Find My Location Button -->
        <div id="location-button" class="leaflet-control leaflet-bar">
        <a href="#" title="Find My Location" role="button" aria-label="Find My Location">
        <img src="Icons/location_icon.png" alt="My Location" class="location-icon">
        </a>
       </div>

           <div id="identify-button" class="leaflet-control leaflet-bar">
    <a href="#" title="Identify Features" role="button" aria-label="Identify Features">
        <img src="Icons/identify.png" alt="Identify" class="identify-icon">
    </a>
</div>

<!-- Identify Results Panel -->
<div id="identify-results">
    <div class="identify-results-header">
        <h4>Identified Features</h4>
        <div class="identify-results-count">0 features found</div>
    </div>
    <div class="identify-results-container">
        <!-- Results will be populated here -->
    </div>
</div> 

<!-- Zoom to Original Extent Button -->
<div id="zoom-extent-button" class="leaflet-control leaflet-bar">
    <a href="#" title="Zoom to Original Extent" role="button" aria-label="Zoom to Original Extent">
        <img src="Icons/globe_icon.png" alt="Zoom to Extent" class="zoom-extent-icon">
    </a>
</div>
            
            <div id="map"></div>
            
            <!-- Coordinates display -->
            <div id="coordinates"></div>
        </div>
    </div>
    
    <!-- Legal disclaimer modal -->
    <div class="modal-overlay" id="disclaimer-modal">
        <div class="modal-container">
            <div class="modal-header">
                <div class="modal-title">Disclaimer</div>
                <div class="modal-close" id="disclaimer-close">&times;</div>
            </div>
            <div class="modal-content">
                <p>The generalized geological (1:1000,000) data presented in this app are a subset of data from the Ministry of Industries ,Mines and Energy (MIME). MIME makes no claims, no representations, and no warranties (express or implied), concerning the validity (express or implied), the reliability or the accuracy of the GIS data and GIS data products furnished by the Ministry, including the implied validity of any uses of such data.</p>
                <p>For detailed and accurate information, please <a href="https://www.mme.gov.na/contact-us/" target="_blank"> CLICK HERE</a> to contact the Ministry of Industries, Mines and Energy.</p>
            </div>
            <div class="modal-footer">
                <button class="modal-button" id="disclaimer-close-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- AI Chat Modal -->
    <div class="modal-overlay" id="ai-modal" style="display: none;">
        <div class="modal-container" style="width: 350px; height: 500px; display: flex; flex-direction: column;">
            <div class="modal-header">
                <div class="modal-title">Nam Geology AI Assistant</div>
                <div class="modal-close" id="ai-close">&times;</div>
            </div>
            <div class="modal-content" style="flex: 1; overflow-y: auto; padding: 10px;" id="ai-chat">
                <!-- AI chat messages will appear here -->
                <div class="ai-message ai-response">
                    <p>Hello! I'm your geology assistant. Ask me anything about Namibia's geology,minerals, rock types, or this app.</p>
                </div>
            </div>
            <div class="modal-footer" style="padding: 10px;">
                <div style="display: flex; width: 100%;">
                    <input type="text" id="ai-input" placeholder="Ask about Namibia's geology..." style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                    <button id="ai-send" style="margin-left: 5px; padding: 8px 15px; background-color: #5c7299; color: white; border: none; border-radius: 4px; cursor: pointer;">Send</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Leaflet JavaScript library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
    <!-- Main application script -->
    <script src="js/app.js"></script>
</body>
</html>
